<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Matthew Forrest" />

<meta name="date" content="2018-10-22" />

<title>Writing or Modifying a Format</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Writing or Modifying a Format</h1>
<h4 class="author"><em>Matthew Forrest</em></h4>
<h4 class="date"><em>2018-10-22</em></h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This vignette describes how to manipulate and create <code>Format</code> objects in DGVMTools. A <code>Format</code> is an S4-class (like all objects in DGVMTools), and it has 6 slots (the slots are described below). <code>Format</code> objects are pretty important because the contain a lot of metadata about a model output or data set files, so without it DGVMTools won’t be able to read the data from disk. One simple modification to a <code>Format</code> object is to add a new PFT. This is a fairly common for a DGVM development task, so this will be described seperately in a short, first section.</p>
<p>Writing code to describe a new <code>Format</code> object is essential for reading a new DGVM or other data source. So the second (and much longer) part of this vignette describes how to do that. It is also a reference for making more complicated modifications to an existing <code>Format</code> (for example reading new model variables)</p>
<p>Note: It doesn’t really make sense to write a new Format for one dataset (that is probably overkill and it would probably rather make sense to bash the data in a DGVMData <code>Format</code>, rather than define a new <code>Format</code>), but it might make sense for many datatsets with a standard file format, for example MODIS or Fluxnet.</p>
<div id="simple-case-adding-a-new-pft-to-a-format-object" class="section level2">
<h2>Simple case: Adding a new PFT to a <code>Format</code> object</h2>
<p>A <code>Format</code> is an S4-class, and like all S4 classes the slots are accessed using the @ symbol. So, for example, to access the id slot of the pre-defined <code>GUESS</code> format:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">GUESS@id</code></pre></div>
<pre><code>## [1] &quot;GUESS&quot;</code></pre>
<p>The <span class="citation">@default.pfts</span> slot is just a list of DGVMTools::PFT objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">original.PFTs &lt;-<span class="st"> </span>GUESS@default.pfts

<span class="kw">str</span>(original.PFTs)</code></pre></div>
<pre><code>## List of 12
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;BNE&quot;
##   .. ..@ name           : chr &quot;Boreal Needleleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Boreal&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;darkblue&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;BINE&quot;
##   .. ..@ name           : chr &quot;Boreal Shade-Intolerant Needleleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Boreal&quot;
##   .. ..@ shade.tolerance: chr &quot;BNE&quot;
##   .. ..@ colour         : chr &quot;dodgerblue3&quot;
##  $ BNS:Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;BNS&quot;
##   .. ..@ name           : chr &quot;Boreal Needleleaved Summergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Summergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Boreal&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;cadetblue2&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;IBS&quot;
##   .. ..@ name           : chr &quot;Shade-intolerant B/leaved Summergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Summergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;chartreuse&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TeBE&quot;
##   .. ..@ name           : chr &quot;Temperate Broadleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;darkgreen&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TeNE&quot;
##   .. ..@ name           : chr &quot;Temperate Needleleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;lightseagreen&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TeBS&quot;
##   .. ..@ name           : chr &quot;Temperate Broadleaved Summergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Summergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;darkolivegreen3&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TrBE&quot;
##   .. ..@ name           : chr &quot;Tropical Broadleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Tropical&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;orchid4&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TrIBE&quot;
##   .. ..@ name           : chr &quot;Tropical Shade-intolerant Broadleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Tropical&quot;
##   .. ..@ shade.tolerance: chr &quot;TrBE&quot;
##   .. ..@ colour         : chr &quot;orchid&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TrBR&quot;
##   .. ..@ name           : chr &quot;Tropical Broadleaved Raingreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Raingreen&quot;
##   .. ..@ climate.zone   : chr &quot;Tropical&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;palevioletred&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;C3G&quot;
##   .. ..@ name           : chr &quot;Boreal/Temperate Grass&quot;
##   .. ..@ growth.form    : chr &quot;Grass&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;GrassPhenology&quot;
##   .. ..@ climate.zone   : chr &quot;NA&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;lightgoldenrod1&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;C4G&quot;
##   .. ..@ name           : chr &quot;Tropical Grass&quot;
##   .. ..@ growth.form    : chr &quot;Grass&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;GrassPhenology&quot;
##   .. ..@ climate.zone   : chr &quot;NA&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;sienna2&quot;</code></pre>
<p>To add a new PFT we can simple take our copy of the list, add a new PFT, and copy it back into the <code>Format</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.PFT =<span class="st">  </span><span class="kw">new</span>(<span class="st">&quot;PFT&quot;</span>,
               <span class="dt">id =</span> <span class="st">&quot;NewPFT&quot;</span>,
               <span class="dt">name =</span> <span class="st">&quot;Some New Tree PFT&quot;</span>,
               <span class="dt">growth.form =</span> <span class="st">&quot;Tree&quot;</span>,
               <span class="dt">leaf.form =</span> <span class="st">&quot;Broadleaved&quot;</span>,
               <span class="dt">phenology =</span> <span class="st">&quot;Summergreen&quot;</span>,
               <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>,
               <span class="dt">climate.zone =</span> <span class="st">&quot;Temperate&quot;</span>,
               <span class="dt">shade.tolerance =</span> <span class="st">&quot;None&quot;</span>
)

new.PFT.list &lt;-<span class="st"> </span><span class="kw">append</span>(original.PFTs, new.PFT)

<span class="kw">print</span>(<span class="kw">str</span>(new.PFT.list))</code></pre></div>
<pre><code>## List of 13
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;BNE&quot;
##   .. ..@ name           : chr &quot;Boreal Needleleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Boreal&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;darkblue&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;BINE&quot;
##   .. ..@ name           : chr &quot;Boreal Shade-Intolerant Needleleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Boreal&quot;
##   .. ..@ shade.tolerance: chr &quot;BNE&quot;
##   .. ..@ colour         : chr &quot;dodgerblue3&quot;
##  $ BNS:Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;BNS&quot;
##   .. ..@ name           : chr &quot;Boreal Needleleaved Summergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Summergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Boreal&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;cadetblue2&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;IBS&quot;
##   .. ..@ name           : chr &quot;Shade-intolerant B/leaved Summergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Summergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;chartreuse&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TeBE&quot;
##   .. ..@ name           : chr &quot;Temperate Broadleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;darkgreen&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TeNE&quot;
##   .. ..@ name           : chr &quot;Temperate Needleleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Needleleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;lightseagreen&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TeBS&quot;
##   .. ..@ name           : chr &quot;Temperate Broadleaved Summergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Summergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;darkolivegreen3&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TrBE&quot;
##   .. ..@ name           : chr &quot;Tropical Broadleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Tropical&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;orchid4&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TrIBE&quot;
##   .. ..@ name           : chr &quot;Tropical Shade-intolerant Broadleaved Evergreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Evergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Tropical&quot;
##   .. ..@ shade.tolerance: chr &quot;TrBE&quot;
##   .. ..@ colour         : chr &quot;orchid&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;TrBR&quot;
##   .. ..@ name           : chr &quot;Tropical Broadleaved Raingreen Tree&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Raingreen&quot;
##   .. ..@ climate.zone   : chr &quot;Tropical&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;palevioletred&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;C3G&quot;
##   .. ..@ name           : chr &quot;Boreal/Temperate Grass&quot;
##   .. ..@ growth.form    : chr &quot;Grass&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;GrassPhenology&quot;
##   .. ..@ climate.zone   : chr &quot;NA&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;lightgoldenrod1&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;C4G&quot;
##   .. ..@ name           : chr &quot;Tropical Grass&quot;
##   .. ..@ growth.form    : chr &quot;Grass&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;GrassPhenology&quot;
##   .. ..@ climate.zone   : chr &quot;NA&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;sienna2&quot;
##  $    :Formal class 'PFT' [package &quot;DGVMTools&quot;] with 8 slots
##   .. ..@ id             : chr &quot;NewPFT&quot;
##   .. ..@ name           : chr &quot;Some New Tree PFT&quot;
##   .. ..@ growth.form    : chr &quot;Tree&quot;
##   .. ..@ leaf.form      : chr &quot;Broadleaved&quot;
##   .. ..@ phenology      : chr &quot;Summergreen&quot;
##   .. ..@ climate.zone   : chr &quot;Temperate&quot;
##   .. ..@ shade.tolerance: chr &quot;None&quot;
##   .. ..@ colour         : chr &quot;red&quot;
## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">GUESS@default.pfts &lt;-<span class="st"> </span>new.PFT.list</code></pre></div>
<p>And done!</p>
<p>Note that this change will only remain active in this particular R session (it doesn’t modify the <code>Format</code> in the package), so you will need to do it once at the top of your analysis script.</p>
</div>
<div id="writing-a-new-format-or-more-involved-modifications" class="section level2">
<h2>Writing a new <code>Format</code> (or more involved modifications)</h2>
<p>Writing a completely new <code>Format</code> is obviously more involved, and in this case details will depends very much on the way the data files are structered. If you are making a new <code>Format</code> to read ASCII data then the Format-GUESS.R is a good reference. If you are writing a format for netCDF data, use Format-DGVMData.R for reference.</p>
<p>This section of the vignette also gives some idea for how to do ‘intermediate level’ modifications to a <code>Format</code> object, for example added a new <code>Quantity</code>.</p>
<p>The function of each of the 6 slots in a <code>Format</code> is discussed below.</p>
<div id="the-id-slot" class="section level3">
<h3>1. The <code>id</code> slot</h3>
<p>This is very simple, just a character string to uniquely identify this format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id_NewFormat &lt;-<span class="st"> &quot;Example_Format&quot;</span></code></pre></div>
</div>
<div id="the-default.pfts-slot" class="section level3">
<h3>2. The <code>default.pfts</code> slot</h3>
<p>This is a list of DGVMTools::PFT objects. If the format is for a DGVM, these PFTs should correspond to the standard default PFTs in the DGVM. If the format is for a data set, PFTs might not make sense so this can just be an empty list. Alternatively the PFT or vegetation type concept might be useful for data, so they could be defined if they exist in the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PFTs_NewFormat &lt;-<span class="st"> </span><span class="kw">list</span>(
  
  <span class="co"># A couple of tree PFTs</span>
  
  <span class="dt">TeBE =</span> <span class="kw">new</span>(<span class="st">&quot;PFT&quot;</span>,
             <span class="dt">id =</span> <span class="st">&quot;TeBE&quot;</span>,
             <span class="dt">name =</span> <span class="st">&quot;Temperate Broadleaved Evergreen Tree&quot;</span>,
             <span class="dt">growth.form =</span> <span class="st">&quot;Tree&quot;</span>,
             <span class="dt">leaf.form =</span> <span class="st">&quot;Broadleaved&quot;</span>,
             <span class="dt">phenology =</span> <span class="st">&quot;Evergreen&quot;</span>,
             <span class="dt">climate.zone =</span> <span class="st">&quot;Temperate&quot;</span>,
             <span class="dt">colour =</span> <span class="st">&quot;darkgreen&quot;</span>,
             <span class="dt">shade.tolerance =</span> <span class="st">&quot;None&quot;</span>
  ),
  
  
  <span class="dt">TeBS =</span> <span class="kw">new</span>(<span class="st">&quot;PFT&quot;</span>,
             <span class="dt">id =</span> <span class="st">&quot;TeBS&quot;</span>,
             <span class="dt">name =</span> <span class="st">&quot;Temperate Broadleaved Summergreen Tree&quot;</span>,
             <span class="dt">growth.form =</span> <span class="st">&quot;Tree&quot;</span>,
             <span class="dt">leaf.form =</span> <span class="st">&quot;Broadleaved&quot;</span>,
             <span class="dt">phenology =</span> <span class="st">&quot;Summergreen&quot;</span>,
             <span class="dt">colour =</span> <span class="st">&quot;darkolivegreen3&quot;</span>,
             <span class="dt">climate.zone =</span> <span class="st">&quot;Temperate&quot;</span>,
             <span class="dt">shade.tolerance =</span> <span class="st">&quot;None&quot;</span>
  ),
  
  
  <span class="co"># And a couple of grasses</span>
  
  <span class="dt">C3G =</span> <span class="kw">new</span>(<span class="st">&quot;PFT&quot;</span>,
            <span class="dt">id =</span> <span class="st">&quot;C3G&quot;</span>,
            <span class="dt">name =</span> <span class="st">&quot;Boreal/Temperate Grass&quot;</span>,
            <span class="dt">growth.form =</span> <span class="st">&quot;Grass&quot;</span>,
            <span class="dt">leaf.form =</span> <span class="st">&quot;Broadleaved&quot;</span>,
            <span class="dt">phenology =</span> <span class="st">&quot;GrassPhenology&quot;</span>,
            <span class="dt">climate.zone =</span> <span class="st">&quot;NA&quot;</span>,
            <span class="dt">colour =</span> <span class="st">&quot;lightgoldenrod1&quot;</span>,
            <span class="dt">shade.tolerance =</span> <span class="st">&quot;None&quot;</span>
  ),
  
  <span class="dt">C4G =</span> <span class="kw">new</span>(<span class="st">&quot;PFT&quot;</span>,
            <span class="dt">id =</span> <span class="st">&quot;C4G&quot;</span>,
            <span class="dt">name =</span> <span class="st">&quot;Tropical Grass&quot;</span>,
            <span class="dt">growth.form =</span> <span class="st">&quot;Grass&quot;</span>,
            <span class="dt">leaf.form =</span> <span class="st">&quot;Broadleaved&quot;</span>,
            <span class="dt">phenology =</span> <span class="st">&quot;GrassPhenology&quot;</span>,
            <span class="dt">climate.zone =</span> <span class="st">&quot;NA&quot;</span>,
            <span class="dt">colour =</span> <span class="st">&quot;sienna2&quot;</span>,
            <span class="dt">shade.tolerance =</span> <span class="st">&quot;None&quot;</span>
  )
  
)

<span class="co"># Now take a look at them</span>
for(PFT in PFTs_NewFormat) {
  <span class="kw">print</span>(PFT)
}</code></pre></div>
<pre><code>## PFT: TeBE (Temperate Broadleaved Evergreen Tree): Growth form=Tree, Leaf form=Broadleaved, Phenology=Evergreen, Climate zone=Temperate, Shade tolerance=None, Preferred colour=darkgreen
## PFT: TeBS (Temperate Broadleaved Summergreen Tree): Growth form=Tree, Leaf form=Broadleaved, Phenology=Summergreen, Climate zone=Temperate, Shade tolerance=None, Preferred colour=darkolivegreen3
## PFT: C3G (Boreal/Temperate Grass): Growth form=Grass, Leaf form=Broadleaved, Phenology=GrassPhenology, Climate zone=NA, Shade tolerance=None, Preferred colour=lightgoldenrod1
## PFT: C4G (Tropical Grass): Growth form=Grass, Leaf form=Broadleaved, Phenology=GrassPhenology, Climate zone=NA, Shade tolerance=None, Preferred colour=sienna2</code></pre>
</div>
<div id="the-quantities-slot" class="section level3">
<h3>3. The <code>quantities</code> slot</h3>
<p>This is a list of DGVMTools::Quantity objects. These correspond to the variables that might be in the dataset/model output that one might want to read. For example LAI, biomass, evapotranspiation, GPP/NPP, soil water content. Note that they don’t <em>need</em> to be there in every run, (and you don’t need to define all variables straight away), but if you want to use them in DGVMTools you need to define them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">quantities_NewFormat &lt;-<span class="st"> </span><span class="kw">list</span>(
  
  <span class="co"># Just a couple of example quantities</span>
  
  <span class="kw">new</span>(<span class="st">&quot;Quantity&quot;</span>,
      <span class="dt">id =</span> <span class="st">&quot;LAI&quot;</span>,
      <span class="dt">name =</span> <span class="st">&quot;LAI&quot;</span>,
      <span class="dt">units =</span> <span class="st">&quot;m^2/m^2&quot;</span>,
      <span class="dt">colours =</span> reversed.viridis,
      <span class="dt">format =</span> <span class="kw">c</span>(<span class="st">&quot;Example_Format&quot;</span>),
      <span class="dt">cf.name =</span> <span class="st">&quot;leaf_area_index&quot;</span>),
  
  <span class="kw">new</span>(<span class="st">&quot;Quantity&quot;</span>,
      <span class="dt">id =</span> <span class="st">&quot;Veg_C&quot;</span>,
      <span class="dt">name =</span> <span class="st">&quot;Vegetation Carbon Mass&quot;</span>,
      <span class="dt">units =</span> <span class="st">&quot;kgC/m^2&quot;</span>,
      <span class="dt">colours =</span> viridis::viridis,
      <span class="dt">format =</span> <span class="kw">c</span>(<span class="st">&quot;Example_Format&quot;</span>))
)

<span class="co"># Now take a look at them</span>
for(quant in quantities_NewFormat ) {
  <span class="kw">print</span>(quant)
}</code></pre></div>
<pre><code>## Quantity:
##      LAI (LAI): Units=m^2/m^2, Defined for format: Example_Format
## Quantity:
##      Veg_C (Vegetation Carbon Mass): Units=kgC/m^2, Defined for format: Example_Format</code></pre>
</div>
<div id="the-determinepfts-slot" class="section level3">
<h3>4. The <code>determinePFTs</code> slot</h3>
<p>This is a function which will look at a some output files on a disk (normally output from a DGVM run) and return a list of PFTs present. The first argument should be <code>Source</code> object called <code>x</code> (see main documentation), and it can have additional arguments that might be needed</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">determinePFTs_NewFormat &lt;-<span class="st"> </span>function(directory, <span class="dt">names =</span> <span class="ot">TRUE</span>){
  
  <span class="co"># typical stuff </span>
  run.directory &lt;-<span class="st"> </span>x@dir
  
  <span class="co"># all possible PFTs present </span>
  PFTs.possible &lt;-<span class="st"> </span>x@pft.set
  
  <span class="co"># code to look for and open a commen per-PFT output file (for example LAI) </span>
  <span class="co"># typical files to check could be specified in 'additional.args' argument for example</span>
  <span class="co"># ...</span>
  
  <span class="co"># code check the ASCII header or netCDF meta info to see what PFTs are present</span>
  <span class="co"># ...</span>
  PFTs.present &lt;-<span class="st"> </span><span class="kw">list</span>() <span class="co"># dummy code</span>
  
  <span class="kw">return</span>(PFTs.present)
  
} </code></pre></div>
</div>
<div id="the-determinequantities-slot" class="section level3">
<h3>5. The <code>determineQuantities</code> slot</h3>
<p>This is a function which will look at a some output files on a disk (normally output from a DGVM run) and return a list of PFTs present. The first argument should be characters with the path to the files on disk, the second argument is a ogical called names. If TRUE, the function should return a list of the ids of the quantities, otherwise it returns the list of DGVMTools::Quantity objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">availableQuantities_NewFormat &lt;-<span class="st"> </span>function(x, additional.args){ 
  
  <span class="co"># typical stuff </span>
  <span class="co"># * get a list of files in the directory</span>
  <span class="co"># * scan the files for different variables</span>
  <span class="co"># * build a list of qunatities present in the model output / dataset</span>
  
  <span class="co"># dummy code</span>
  Quantities.present &lt;-<span class="st"> </span><span class="kw">list</span>()
  <span class="kw">return</span>(Quantities.present)
  
} </code></pre></div>
</div>
<div id="the-getfield-slot" class="section level3">
<h3>6. The <code>getField</code> slot</h3>
<p>This is the biggie! This function (which will be long, but can of course make use of other functions) is responsible for reading data from disk and bashing it into a data.table; and for r. As arguments it takes:</p>
<ul>
<li>a DGVMTools::Source (source)object from which the data is to be read</li>
<li>a DGVMTools::Quantity (quant) object specifying what vairbale is be returned</li>
<li>a DGVMTools::STAInfo (sta.info) object specifying the spatial-temporal-annual dimensions of the field</li>
<li>a logical (verbose), if TRUE then function should give more output</li>
<li>… other flexible arguments which can be</li>
</ul>
<p>It should return a two-element list comprising:</p>
<ul>
<li>“dt” : a data.table containign the data, properly formatted</li>
<li>“sta.info” : an STAInfo describing the spatial-temporal-annual dimensions of the data being returned as the “dt”</li>
</ul>
<p>Note that the input and output “sta.info” don’t need to match, the rest of the the cropping/aggregating is done automatically by the package, but it maybe more efficient to read only a subset of the data (eg. for netCDF files), rather than read the whole files and then crop it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">getField_NewFormat &lt;-<span class="st"> </span>function(source, quant, sta.info, verbose, ...){ 
  
  <span class="co"># code needs to get the data as a data.table</span>
  dt &lt;-<span class="st"> </span><span class="kw">data.table</span>()
  
  <span class="co"># also an STAInfo object</span>
  return.sta.info &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;STAInfo&quot;</span>)
    
  <span class="co"># dummy code</span>
  return.list &lt;-<span class="st"> </span><span class="kw">list</span>()
  return.list[[<span class="st">&quot;dt&quot;</span>]] &lt;-<span class="st"> </span>dt
  return.list[[<span class="st">&quot;sta.info&quot;</span>]] &lt;-<span class="st"> </span>return.sta.info
   
  <span class="kw">return</span>(return.list)
  
} </code></pre></div>
</div>
<div id="combining" class="section level3">
<h3>Combining</h3>
<p>Finally we can combine the six parts that we just made to make the new <code>Format</code> object,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NewFormat &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;Format&quot;</span>, 
                 <span class="dt">id =</span> id_NewFormat,
                 <span class="dt">default.pfts =</span> PFTs_NewFormat, 
                 <span class="dt">quantities =</span> quantities_NewFormat, 
                 <span class="dt">determinePFTs =</span> determinePFTs_NewFormat, 
                 <span class="dt">availableQuantities =</span> availableQuantities_NewFormat, 
                 <span class="dt">getField =</span>getField_NewFormat)</code></pre></div>
<p>And there we go. A new <code>Format</code> object. Obviously the trickness is defining the functions, <code>particularly getField()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(NewFormat)</code></pre></div>
<pre><code>## Format:
## id = &quot;Example_Format&quot;
## Default PFTs:
## PFT: TeBE (Temperate Broadleaved Evergreen Tree): Growth form=Tree, Leaf form=Broadleaved, Phenology=Evergreen, Climate zone=Temperate, Shade tolerance=None, Preferred colour=darkgreen
## PFT: TeBS (Temperate Broadleaved Summergreen Tree): Growth form=Tree, Leaf form=Broadleaved, Phenology=Summergreen, Climate zone=Temperate, Shade tolerance=None, Preferred colour=darkolivegreen3
## PFT: C3G (Boreal/Temperate Grass): Growth form=Grass, Leaf form=Broadleaved, Phenology=GrassPhenology, Climate zone=NA, Shade tolerance=None, Preferred colour=lightgoldenrod1
## PFT: C4G (Tropical Grass): Growth form=Grass, Leaf form=Broadleaved, Phenology=GrassPhenology, Climate zone=NA, Shade tolerance=None, Preferred colour=sienna2
## Defined Quantities:
## Quantity:
##      LAI (LAI): Units=m^2/m^2, Defined for format: Example_Format
## Quantity:
##      Veg_C (Vegetation Carbon Mass): Units=kgC/m^2, Defined for format: Example_Format</code></pre>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
